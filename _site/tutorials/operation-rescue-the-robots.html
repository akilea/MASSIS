<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Operation: Rescue the robots. Part 1 &middot; MASSIS
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/massis.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-massis">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/"><img src="http://i.imgur.com/SyxoguR.png" alt="MASSIS"></a>
      </h1>
      <p class="lead">A Framework for MultiAgent System Simulation of Indoor Scenarios</p>
    </div>

    <nav class="sidebar-nav">
      

      

      
      
        <a class="sidebar-nav-item" href="/">Home </a>
      
        <a class="sidebar-nav-item" href="/getting-started/">Getting started </a>
      
        <a class="sidebar-nav-item" href="/tutorials/">Tutorials </a>
      


      <a class="sidebar-nav-item" href="https://github.com/rpax/MASSIS">GitHub project</a>
      <a class="sidebar-nav-item" href="/contact.html">Contact</a>
<!--      <span class="sidebar-nav-item">Currently v1.2.10</span>
-->
    </nav>
      <p style="font-size:small">
       This work has been partially supported by the project  <a href="http://www.gsi.dit.upm.es/mosi/">MOSI-AGIL S2013/ICE-3019</a>
      </p>
      <p>
        <img src="http://i.imgur.com/idt5WlN.png" style="width:99%">
      </p>

    <p style="font-size:small">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
    </a>
    <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">MASSIS</span> by
    <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Rafael Pax & Juan Pav√≥n (UCM GRASIA)</span>
    is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
    <!-- Logos -->
   
 </p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Operation: Rescue the robots. Part 1</h1>
  <p>It is assumed in this tutorial that the reader has already gone through the basic tutorials, such as <a href="/getting-started.html">the Getting started</a> and <a href="/tutorials/01-sample-massis-application.html">Creating a MASSIS Project</a> sections have been already been read.</p>

<p>For designing the scenario, it is also recommended to read the <a href="/tutorials/04-bigger-environment-and-multiple-agents.html">environment design</a> section.</p>

<h2 id="scenario-description">Scenario description</h2>

<p>The impact of a meteorite has caused irreparable damage to an extraterrestrial station. Luckily, there were no humans on the station, only robots.</p>

<p>But these robots were controlled remotely, and the meteorite impact has broken one antenna. In order to solve this issue, a new kind of robots are sent to this station. Their mission will consist on rescuing the robots that are in the incommunicated station, by finding  and taking them to the landing zone of the station.</p>

<p>The file with the description of this extraterrestrial station for this tutorial can be downloaded <a href="https://drive.google.com/open?id=0B3-oRpDTDan3Z3dRQmVXalBYYkU">from here</a>. When opening this should look something like this figure:</p>

<p><img src="http://i.imgur.com/tRexsTw.png" alt="Scenario"></p>

<p>There are two kinds of robots, those that  were in the station (workers), and those that have arrived to rescue them (rescuers). Their behaviour, in this case of incommunication of the station, is the following:</p>

<ul>
<li><strong>Worker</strong> robot behavior

<ol>
<li>Wait  until someone tells it what target should be following.</li>
</ol></li>
<li><strong>Rescuer</strong> robot behavior

<ol>
<li>Try to visit all the rooms in the building. Whenever this robot sees a worker robot in the room, requests that worker robot to follow it.</li>
<li>When two (or more) <em>rescuer</em> robots are in the same room, they share information about the rooms visited.</li>
<li>When all the rooms have been explored, the robot goes back to the <em>landing zone</em></li>
</ol></li>
</ul>

<h2 id="implementation-from-the-idea-to-the-code">Implementation - From the idea to the code</h2>

<p>This project will be based on the  <a href="/tutorials/01-sample-massis-application.html">basic MASSIS archetype explained previously</a>.</p>

<h3 id="two-behaviors-imply-two-classes">Two behaviors imply two classes.</h3>

<p>Each behavior should be modeled as a Java class. In this scenario, we have two different behaviors, the <em>Worker</em> behavior and the <em>Rescuer</em> behavior.</p>

<p>The <em>Worker</em> behavior is fairly simple. It is waiting and when it has a target to follow, continues to do this forever. A Rescuer agent will indicate that target when it finds it by using the method <code>setFollowTarget()</code>.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">myawesomesimulator</span><span class="o">.</span><span class="na">ai</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.logging.Level</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.massisframework.massis.model.agents.HighLevelController</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.massisframework.massis.model.agents.LowLevelAgent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.massisframework.massis.model.managers.movement.ApproachCallback</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.massisframework.massis.pathfinding.straightedge.FindPathResult.PathFinderErrorReason</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WorkerController</span> <span class="kd">extends</span> <span class="n">HighLevelController</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

  <span class="kd">private</span> <span class="n">LowLevelAgent</span> <span class="n">followTarget</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">WorkerController</span><span class="o">(</span><span class="n">LowLevelAgent</span> <span class="n">agent</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">metadata</span><span class="o">,</span>
      <span class="n">String</span> <span class="n">resourcesFolder</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">agent</span><span class="o">,</span> <span class="n">metadata</span><span class="o">,</span> <span class="n">resourcesFolder</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">agent</span><span class="o">.</span><span class="na">setHighLevelData</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">step</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">followTarget</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">agent</span><span class="o">.</span><span class="na">approachTo</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">followTarget</span><span class="o">.</span><span class="na">getLocation</span><span class="o">(),</span>
        <span class="k">new</span> <span class="nf">ApproachCallback</span><span class="o">()</span> <span class="o">{</span>

          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTargetReached</span><span class="o">(</span><span class="n">LowLevelAgent</span> <span class="n">agent</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Nothing. We are going to follow the target forever.</span>

          <span class="o">}</span>

          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSucess</span><span class="o">(</span><span class="n">LowLevelAgent</span> <span class="n">agent</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Continue following the target.</span>
          <span class="o">}</span>

          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPathFinderError</span><span class="o">(</span><span class="n">PathFinderErrorReason</span> <span class="n">reason</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">WorkerController</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()).</span><span class="na">log</span><span class="o">(</span>
                <span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span>
                <span class="s">&quot;An error occurred when approaching to {0}. Reason: {1}&quot;</span><span class="o">,</span>
                <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">followTarget</span><span class="o">.</span><span class="na">getLocation</span><span class="o">(),</span> <span class="n">reason</span> <span class="o">});</span>

          <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFollowTarget</span><span class="o">(</span><span class="n">LowLevelAgent</span> <span class="n">agent</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">followTarget</span> <span class="o">=</span> <span class="n">agent</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isFollowingSomeone</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">followTarget</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>That is! Simple, huh?</p>

<p>The <em>Rescuer</em> behavior is a little more tricky. Let&#39;s split it into parts:</p>

<ul>
<li><em>Try to explore all the rooms in the building.</em>

<ul>
<li>This implies that the robot should track the rooms that it has visited.</li>
</ul></li>
<li><em>Whenever the Rescuer robot finds a worker robot in the room, it makes that worker robot to follow it.</em>

<ul>
<li>Gathering information about the current room.</li>
</ul></li>
<li><em>When two (or more) Rescuer robots are in the same room, they share information about the rooms visited.</em>

<ul>
<li>This can be accomplished by interchanging the visited rooms of each robot.</li>
</ul></li>
<li><em>When all the rooms have been explored, the robot goes back to the landing zone</em>

<ul>
<li>This is just a basic operation.</li>
</ul></li>
</ul>

<p>With this facts identified, the only thing left is to code them in a <code>HighLevelController</code>.
As we have created the project using the archetype, designing the behavior becomes a <em>fill in the gaps</em> exercise.</p>

<p>Several  attributes are needed to account for the unexplored rooms, the next room to visit and (optional, but useful in this case) if the work has finished or not.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">SimRoom</span><span class="o">&gt;</span> <span class="n">roomsUnexplored</span><span class="o">;</span>
<span class="kd">private</span> <span class="n">SimRoom</span> <span class="n">assignedRoom</span><span class="o">;</span>
<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">workFinished</span><span class="o">;</span>
</code></pre></div>
<p>These attributes are initialized in the constructor, to indicate  the collection of unexplored rooms, and setting the <code>workFinished</code> attribute to false.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">RescuerController</span><span class="o">(</span><span class="n">LowLevelAgent</span> <span class="n">agent</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">metadata</span><span class="o">,</span>
        <span class="n">String</span> <span class="n">resourcesFolder</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">agent</span><span class="o">,</span> <span class="n">metadata</span><span class="o">,</span> <span class="n">resourcesFolder</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">agent</span><span class="o">.</span><span class="na">setHighLevelData</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">workFinished</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">roomsUnexplored</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">SimRoom</span> <span class="n">r</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">agent</span><span class="o">.</span><span class="na">getLocation</span><span class="o">().</span><span class="na">getFloor</span><span class="o">().</span><span class="na">getRooms</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roomsUnexplored</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">r</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">this</span><span class="o">.</span><span class="na">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="s">&quot;Rescuer_&quot;</span> <span class="o">+</span> <span class="n">agent</span><span class="o">.</span><span class="na">getID</span><span class="o">());</span>
    <span class="k">this</span><span class="o">.</span><span class="na">assignNewRoomToExplore</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>
<p>This robot should be capable of auto-assigning rooms to explore:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">assignNewRoomToExplore</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">roomsUnexplored</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">SimRoom</span><span class="o">[]</span> <span class="n">rem</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">roomsUnexplored</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">SimRoom</span><span class="o">[]</span> <span class="o">{});</span>
        <span class="k">this</span><span class="o">.</span><span class="na">assignedRoom</span> <span class="o">=</span> <span class="n">rem</span><span class="o">[</span><span class="n">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">()</span>
                <span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">rem</span><span class="o">.</span><span class="na">length</span><span class="o">)];</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roomsUnexplored</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">assignedRoom</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>This robot should also exchange the information about the rooms with other robots:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">shareRoomsWith</span><span class="o">(</span><span class="n">RescuerController</span> <span class="n">rescuer</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// remove every item that is not present in the other map</span>
    <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">changed</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">roomsUnexplored</span>
            <span class="o">.</span><span class="na">retainAll</span><span class="o">(</span><span class="n">rescuer</span><span class="o">.</span><span class="na">roomsUnexplored</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">changed</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span>
                <span class="s">&quot;Updated information about rooms to explore: {0}&quot;</span><span class="o">,</span>
                <span class="k">this</span><span class="o">.</span><span class="na">roomsUnexplored</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>Also, for approaching to its current target, this method can be written for clarity:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">approachToAssignedRoom</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">this</span><span class="o">.</span><span class="na">agent</span><span class="o">.</span><span class="na">approachTo</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">assignedRoom</span><span class="o">.</span><span class="na">getLocation</span><span class="o">(),</span>
    <span class="k">new</span> <span class="nf">ApproachCallback</span><span class="o">()</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTargetReached</span><span class="o">(</span><span class="n">LowLevelAgent</span> <span class="n">agent</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">assignNewRoomToExplore</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSucess</span><span class="o">(</span><span class="n">LowLevelAgent</span> <span class="n">agent</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPathFinderError</span><span class="o">(</span>
                <span class="n">PathFinderErrorReason</span> <span class="n">reason</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span>
                    <span class="s">&quot;An error occurred when approaching to room {0} Reason: {1}&quot;</span><span class="o">,</span>
                    <span class="k">new</span> <span class="n">Object</span><span class="o">[]</span> <span class="o">{</span> <span class="n">reason</span><span class="o">,</span> <span class="n">assignedRoom</span><span class="o">.</span><span class="na">getID</span><span class="o">()</span> <span class="o">});</span>

        <span class="o">}</span>
    <span class="o">});</span>
<span class="o">}</span>
</code></pre></div>
<p>Finally, for approaching to the <em>landing zone</em>,</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">approachToLandingZone</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">workFinished</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">agent</span><span class="o">.</span><span class="na">approachToNamedLocation</span><span class="o">(</span><span class="s">&quot;LANDING_ZONE&quot;</span><span class="o">,</span>
            <span class="k">new</span> <span class="nf">ApproachCallback</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onTargetReached</span><span class="o">(</span><span class="n">LowLevelAgent</span> <span class="n">agent</span><span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// Work finished.</span>
                    <span class="n">RescuerController</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">workFinished</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSucess</span><span class="o">(</span><span class="n">LowLevelAgent</span> <span class="n">agent</span><span class="o">)</span> <span class="o">{</span>
                <span class="o">}</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPathFinderError</span><span class="o">(</span>
                        <span class="n">PathFinderErrorReason</span> <span class="n">reason</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">SEVERE</span><span class="o">,</span>
                            <span class="s">&quot;An error occurred when approaching &quot;</span>
                                    <span class="o">+</span> <span class="s">&quot;to landing zone. Reason: {0}&quot;</span><span class="o">,</span>
                            <span class="n">reason</span><span class="o">);</span>

                <span class="o">}</span>
            <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>These utility methods are intended for their use in the <code>step()</code> method:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">step</span><span class="o">()</span> <span class="o">{</span>
    <span class="cm">/*</span>
<span class="cm">     * Is anybody in the room?</span>
<span class="cm">     */</span>
    <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">roomsUnexplored</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
        <span class="cm">/*</span>
<span class="cm">         * For each agent found in the room, do the corresponding task</span>
<span class="cm">         */</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">LowLevelAgent</span> <span class="n">otherAgent</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">agent</span><span class="o">.</span><span class="na">getAgentsInRoom</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// avoid self</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">agent</span> <span class="o">==</span> <span class="n">otherAgent</span><span class="o">)</span>
                <span class="k">continue</span><span class="o">;</span>
            <span class="cm">/*</span>
<span class="cm">             * Is a rescuer?</span>
<span class="cm">             */</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">otherAgent</span>
                    <span class="o">.</span><span class="na">getHighLevelData</span><span class="o">()</span> <span class="k">instanceof</span> <span class="n">RescuerController</span><span class="o">)</span> <span class="o">{</span>
                <span class="cm">/*</span>
<span class="cm">                 * Affirmative. Share room information</span>
<span class="cm">                 */</span>
                <span class="n">shareRoomsWith</span><span class="o">(</span>
                        <span class="o">(</span><span class="n">RescuerController</span><span class="o">)</span> <span class="n">otherAgent</span><span class="o">.</span><span class="na">getHighLevelData</span><span class="o">());</span>
                <span class="cm">/*</span>
<span class="cm">                 * Is a worker? follow me.</span>
<span class="cm">                 */</span>
            <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">otherAgent</span>
                    <span class="o">.</span><span class="na">getHighLevelData</span><span class="o">()</span> <span class="k">instanceof</span> <span class="n">WorkerController</span><span class="o">)</span> <span class="o">{</span>

                <span class="kd">final</span> <span class="n">WorkerController</span> <span class="n">follower</span> <span class="o">=</span> <span class="o">(</span><span class="n">WorkerController</span><span class="o">)</span> <span class="n">otherAgent</span>
                        <span class="o">.</span><span class="na">getHighLevelData</span><span class="o">();</span>
                <span class="cm">/*</span>
<span class="cm">                 * Check if the robot is already following someone</span>
<span class="cm">                 */</span>
                <span class="k">if</span> <span class="o">(!</span><span class="n">follower</span><span class="o">.</span><span class="na">isFollowingSomeone</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">follower</span><span class="o">.</span><span class="na">setFollowTarget</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">agent</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>

        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">approachToAssignedRoom</span><span class="o">();</span>

    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// Go to landing zone.</span>
        <span class="k">this</span><span class="o">.</span><span class="na">approachToLandingZone</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h1 id="conclusion">Conclusion</h1>

<p>That&#39;s everything! If you prefer to download the entire project, with the building included, <a href="https://drive.google.com/open?id=0B3-oRpDTDan3Nl9pdUdDRUY0cDQ">you can do it from here</a></p>

</div>

<!--<div class="pagination">
  
    <span class="pagination-item newer">Previous</span>
  

  
    <span class="pagination-item older">Next</span>
  
</div>-->

    </div>
<script>
//dirty fix for making this work under github domain
  var fixLinks=function(els) {
      for(var i =0;i<els.length;i++){
        if (els[i].href.indexOf("github.io")>0 && els[i].href.indexOf("github.io/MASSIS")<1)
          els[i].href=els[i].href.replace("github.io","github.io/MASSIS");
      }
  };
  fixLinks(document.getElementsByTagName("a"));
  fixLinks(document.getElementsByTagName("link"));
</script>
<script>
  // Google analytics
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73066450-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
  
</html>
